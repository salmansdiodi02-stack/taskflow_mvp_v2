<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>TaskFlow Admin â€” Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<style>
  :root{
    --bg:#f5f7fb; --card:#fff; --muted:#6b7280; --accent:#7c3aed; --accent-2:#6b21a8; --glass: rgba(255,255,255,0.6);
  }
  [data-theme="dark"]{
    --bg:#0f1724; --card:#111827; --muted:#9ca3af; --accent:#8b5cf6; --accent-2:#7c3aed; --glass: rgba(255,255,255,0.02);
  }
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;background:var(--bg);color:#0b1220}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid rgba(0,0,0,0.06)}
  .wrap{display:flex;min-height:calc(100vh - 64px)}
  .sidebar{width:220px;background:linear-gradient(180deg,rgba(124,58,237,0.06),rgba(124,58,237,0.02));padding:24px;border-right:1px solid rgba(0,0,0,0.05)}
  [data-theme="dark"] .sidebar{background:linear-gradient(180deg,rgba(124,58,237,0.04),rgba(0,0,0,0.02));border-right:1px solid rgba(255,255,255,0.02)}
  .brand{font-weight:800;color:var(--accent);margin-bottom:22px}
  .nav{display:flex;flex-direction:column;gap:8px}
  .nav button{background:transparent;border:0;color:var(--muted);padding:12px;border-radius:10px;text-align:left;cursor:pointer;font-size:15px;font-weight:600;transition:all .25s}
  .nav button.active{background:linear-gradient(90deg,rgba(124,58,237,0.14),rgba(99,102,241,0.06));color:var(--accent)}
  .sidebar .small{font-size:12px;color:var(--muted);margin-top:12px}

  .main{flex:1;padding:24px;transition:all .4s}
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
  .controls{display:flex;gap:10px;align-items:center}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
  .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--muted);font-weight:600}
  [data-theme="dark"] .btn.ghost{border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

  .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,0.06);transition:all .3s}
  [data-theme="dark"] .card{box-shadow:0 6px 18px rgba(2,6,23,0.4)}
  .metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:18px}

  table{width:100%;border-collapse:collapse}
  th,td{padding:8px;text-align:left;font-size:13px;border-bottom:1px solid rgba(0,0,0,0.04);color:var(--muted)}
  [data-theme="dark"] th,[data-theme="dark"] td{border-bottom:1px solid rgba(255,255,255,0.02)}

  .notif{position:fixed;right:22px;bottom:22px;z-index:999}
  .toast{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;padding:12px 14px;border-radius:10px;box-shadow:0 8px 30px rgba(11,20,30,0.3);margin-top:8px;opacity:0;transform:translateY(8px);transition:all .35s}
  .toast.show{opacity:1;transform:none}

  /* Settings */
  .settings-grid{display:flex;flex-direction:column;gap:16px}
  .settings-item{background:var(--card);padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(11,20,30,0.06)}
  .settings-item h4{margin-bottom:8px}
  .status-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}
</style>
</head>
<body>

<header>
  <div style="font-weight:800;color:var(--accent)">TaskFlow Admin</div>
  <div id="serverTime" class="small" style="color:var(--muted)"></div>
</header>

<div class="wrap">
  <aside class="sidebar">
    <div class="brand">TaskFlow</div>
    <div class="nav">
      <button class="active" data-tab="dashboard">Dashboard</button>
      <button data-tab="leads">Leads</button>
      <button data-tab="snapshots">Snapshots</button>
      <button data-tab="settings">Settings</button>
    </div>
    <div class="small">Logged in as Admin</div>
  </aside>

  <main class="main">
    <section id="tab-dashboard">
      <div class="metrics">
        <div class="card"><div>Total Leads</div><h2 id="totalLeads">0</h2></div>
        <div class="card"><div>Bookings This Week</div><h2 id="bookingsWeek">0</h2></div>
        <div class="card"><div>Services</div><h2 id="servicesCount">0</h2></div>
        <div class="card"><div>Pending Follow-ups</div><h2 id="pendingFollowups">0</h2></div>
      </div>
      <div class="card"><canvas id="leadsChart" height="320"></canvas></div>
    </section>

    <section id="tab-leads" style="display:none">
      <div class="card">
        <table><thead><tr><th>Name</th><th>Phone</th><th>Service</th><th>When</th><th>Notes</th></tr></thead>
        <tbody id="leadsTbody"><tr><td colspan="5">No leads yet.</td></tr></tbody></table>
      </div>
    </section>

    <section id="tab-snapshots" style="display:none">
      <div class="card">
        <h3>Snapshots</h3>
        <div id="snapList">Loading snapshots...</div>
      </div>
    </section>

    <section id="tab-settings" style="display:none">
      <div class="settings-grid">
        <div class="settings-item">
          <h4>Admin Info</h4>
          <p><strong>Name:</strong> Salman Ibrahim</p>
        </div>

        <div class="settings-item">
          <h4>System Status</h4>
          <p><span id="statusDot" class="status-dot" style="background:#aaa"></span>
          <span id="statusText">Checking...</span></p>
        </div>

        <div class="settings-item">
          <h4>Theme</h4>
          <button id="themeToggle" class="btn">Toggle Theme</button>
        </div>

        <div class="settings-item">
          <h4>Sound</h4>
          <button id="soundToggle" class="btn ghost">ðŸ”” On</button>
        </div>

        <div class="settings-item">
          <h4>Account</h4>
          <button id="logoutBtn" class="btn ghost">Logout</button>
        </div>
      </div>
    </section>
  </main>
</div>

<div class="notif" id="notifArea"></div>

<script>
(() => {
  const API_BASE = window.location.origin;
  const root = document.body;
  const notifArea = document.getElementById('notifArea');
  const serverTime = document.getElementById('serverTime');
  const statusDot = document.getElementById('statusDot');
  const statusText = document.getElementById('statusText');
  const themeToggle = document.getElementById('themeToggle');
  const soundToggle = document.getElementById('soundToggle');

  // Theme handling
  function applyTheme(t){ root.setAttribute('data-theme', t); localStorage.setItem('tf_theme', t); }
  const storedTheme = localStorage.getItem('tf_theme') || 'light';
  applyTheme(storedTheme);
  themeToggle.onclick = ()=>applyTheme(root.getAttribute('data-theme')==='light'?'dark':'light');

  // Sidebar tabs
  document.querySelectorAll('.nav button').forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      const tab=btn.dataset.tab;
      document.querySelectorAll('main section').forEach(s=>s.style.display=s.id==='tab-'+tab?'':'none');
    };
  });

  // Toasts
  function showToast(t,x){
    const el=document.createElement('div');el.className='toast';el.textContent=t+': '+x;
    notifArea.prepend(el);setTimeout(()=>el.classList.add('show'),30);
    setTimeout(()=>el.remove(),4000);
  }

  // Chart
  const ctx=document.getElementById('leadsChart').getContext('2d');
  let leadsChart=new Chart(ctx,{type:'line',data:{labels:[],datasets:[{label:'Leads',data:[],fill:true,tension:.4,borderColor: '#7c3aed',backgroundColor:'rgba(124,58,237,0.08)'}]},options:{scales:{y:{beginAtZero:true}}}});

  // Socket.io
  const socket=io(API_BASE,{transports:['websocket','polling']});
  socket.on('new_lead',ld=>showToast('New Lead',ld.name));

  // Status checker
  async function ping(){
    try{
      const res=await fetch(API_BASE+'/api/ping');
      if(res.ok){statusDot.style.background='#22c55e';statusText.textContent='Online';}
      else throw 0;
    }catch(e){statusDot.style.background='#dc2626';statusText.textContent='Offline';}
  }
  ping();setInterval(ping,30000);

  // Time updater
  setInterval(()=>serverTime.textContent=new Date().toLocaleString(),1000);
})();
</script>
</body>
</html>
